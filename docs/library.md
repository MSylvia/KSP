Calibre library management
==========================

KSP will continuously monitor the Calibre database file for changes.  If you add books, update a book's metadata, or re-
generate its MOBI files, these changes *should* be visible on your device at the next sync, on the _Archived Items_
page.


Restrictions
------------

Right now, KSP only works with MOBI (and the equivalent formats, AZW and PRC) books in your Calibre library.

These files **must** also have the correct ASIN (book id) metadata embedded in them -- otherwise KSP will just ignore
them. MOBI files generated by Calibre always have the corect ASIN. If you import MOBI books into your Calibre library,
you **must** re-convert them to MOBI -- the original file will be kept, as `*book_name*.ORIGINAL_MOBI`, right next to
the new MOBI file.

The up-side is, the integration with Calibre *should* be seamless. If you connect the Kindle with an USB cable to the
machine, and let Calibre see it, it will see the books -- downloaded through KSP -- from its library as being on the
device.

I'm currently looking at what is necessary to make PDF documents work with KSP.


Generated collections
---------------------

KSP can generate collections based on the books' series and tags. To use them, you need to import these collections into
your device.

Go to [MENU] -> _View Archived Items_ -> _Add Other Device Collections_. You will see a device called _Calibre Library_
-- it's a bogus device, its record generated by KSP.

After importing the collections from the _Calibre Library_ device:

* for each book series, a new collection will be created on the device

* for each configured tag, a new collection named '{*tag_name*}' will be created on the device; if no books (with valid
     files!) have a given tag, that collection will *not* be created on your device.

The tags to generate collections for are configured in `etc/features.py`, the `collection_tags` option.

The generated collections will contain all the matching books in your Calibre library, whether you have them downloaded
onto your device or not.

If you later add more books into a series, or give them a configured tag, you can just re-import the collections from
the bogus _Calibre Library_ device.


Book updates
------------

If the `download_updated_books` option is set in `etc/features.py`, updating book files in Calibre, for a book already
present on your Kindle, will cause the Kindle to download the new version.

**WARNING**: A side-effect is that you will lose the last-read-position, and any notes and highlights on that book!
Basically the Kindle will behave as if the book has just been downloaded for the first time. I don't think this can
be worked around, because the positions are highly dependent on the internal layout if the book.


Notes & Highlights
------------------

At this moment, KSP does **not** back-up the last-read-position, notes and highlights for books downloaded throught it.
This means that if you delete the book from the device, you will lose this information -- though the notes & hightlight
may still be kept in the `My Clippings` file on the device.

If I manage to figure out the details of the MBP format Kindle uses to store these informations, I will add support for
them into KSP.
